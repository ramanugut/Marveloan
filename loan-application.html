<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoanFlow - New Loan Application</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .header { display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px); }
        .logo { display:flex;align-items:center;gap:10px;font-size:24px;font-weight:bold; }
        .logo-icon { width:40px;height:40px;background:rgba(255,255,255,0.2);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px; }
        .back-btn { background:rgba(255,255,255,0.2);border:none;color:white;padding:10px 20px;border-radius:25px;cursor:pointer;transition:all 0.3s ease; }
        .back-btn:hover { background:rgba(255,255,255,0.3);transform:translateY(-2px); }
        .user-profile { width:40px;height:40px;background:rgba(255,255,255,0.2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold; }
        .container { max-width:1200px;margin:0 auto;padding:40px 20px; }
        .page-header { text-align:center;margin-bottom:40px; }
        .page-title { font-size:2.5rem;margin-bottom:10px;font-weight:700; }
        .page-subtitle { font-size:1.1rem;opacity:0.9;max-width:600px;margin:0 auto; }
        .progress-container { background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:20px;padding:40px;margin-bottom:40px; }
        .progress-steps { display:flex;justify-content:space-between;align-items:center;margin-bottom:40px;position:relative; }
        .progress-line { position:absolute;top:25px;left:0;right:0;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;z-index:1; }
        .progress-line-fill { height:100%;background:#4ade80;border-radius:2px;width:25%;transition:width 0.5s ease; }
        .step { display:flex;flex-direction:column;align-items:center;position:relative;z-index:2; }
        .step-circle { width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:18px;margin-bottom:10px;transition:all 0.3s ease; }
        .step.active .step-circle { background:#4ade80;color:white; }
        .step.completed .step-circle { background:#4ade80;color:white; }
        .step.pending .step-circle { background:rgba(255,255,255,0.2);color:rgba(255,255,255,0.7); }
        .step-label { font-size:14px;text-align:center;opacity:0.9; }
        .form-container { background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:20px;padding:40px;margin-bottom:30px; }
        .form-section { margin-bottom:30px; }
        .section-title { font-size:1.5rem;margin-bottom:20px;font-weight:600; }
        .form-grid { display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px; }
        .form-group { display:flex;flex-direction:column; }
        .form-label { margin-bottom:8px;font-weight:500;opacity:0.9; }
        .form-input,.form-select { padding:12px 16px;border:2px solid rgba(255,255,255,0.2);border-radius:10px;background:rgba(255,255,255,0.1);color:white;font-size:16px;transition:all 0.3s ease; }
        .form-input:focus,.form-select:focus { outline:none;border-color:#4ade80;background:rgba(255,255,255,0.15); }
        .form-input::placeholder { color:rgba(255,255,255,0.6); }
        .loan-type-grid { display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px; }
        .loan-type-card { background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.2);border-radius:15px;padding:20px;text-align:center;cursor:pointer;transition:all 0.3s ease; }
        .loan-type-card:hover { border-color:#4ade80;background:rgba(255,255,255,0.15);transform:translateY(-2px); }
        .loan-type-card.selected { border-color:#4ade80;background:rgba(74,222,128,0.2); }
        .loan-type-icon { font-size:2rem;margin-bottom:10px; }
        .loan-type-title { font-weight:600;margin-bottom:5px; }
        .loan-type-desc { font-size:0.9rem;opacity:0.8; }
        .action-buttons { display:flex;gap:20px;justify-content:center;margin-top:30px; }
        .btn { padding:12px 30px;border:none;border-radius:25px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s ease;min-width:150px; }
        .btn-primary { background:#4ade80;color:white; }
        .btn-primary:hover { background:#22c55e;transform:translateY(-2px);box-shadow:0 8px 25px rgba(74,222,128,0.3); }
        .btn-secondary { background:rgba(255,255,255,0.2);color:white; }
        .btn-secondary:hover { background:rgba(255,255,255,0.3);transform:translateY(-2px); }
        .required { color:#fbbf24; }
        @media (max-width:768px){ .header{padding:15px 20px;} .page-title{font-size:2rem;} .progress-container,.form-container{padding:20px;} .progress-steps{flex-direction:column;gap:20px;} .progress-line{display:none;} .form-grid{grid-template-columns:1fr;} .loan-type-grid{grid-template-columns:1fr;} .action-buttons{flex-direction:column;align-items:center;} }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo"><div class="logo-icon">L</div><span>LoanFlow</span></div>
        <button class="back-btn" onclick="goBack()">‚Üê Back to Dashboard</button>
        <div class="user-profile">MR</div>
    </div>
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">üìã New Loan Application</h1>
            <p class="page-subtitle">Process a new loan application quickly and efficiently with our streamlined workflow</p>
        </div>
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line"><div class="progress-line-fill"></div></div>
                <div class="step active"><div class="step-circle">1</div><div class="step-label">Loan Details</div></div>
                <div class="step pending"><div class="step-circle">2</div><div class="step-label">Customer Info</div></div>
                <div class="step pending"><div class="step-circle">3</div><div class="step-label">Documentation</div></div>
                <div class="step pending"><div class="step-circle">4</div><div class="step-label">Review & Submit</div></div>
            </div>
        </div>
        <form id="loanForm" class="form-container">
            <div class="form-section">
                <h2 class="section-title">Loan Type Selection</h2>
                <div class="loan-type-grid">
                    <div class="loan-type-card selected" data-type="personal" onclick="selectLoanType(this)"><div class="loan-type-icon">üè†</div><div class="loan-type-title">Personal Loan</div><div class="loan-type-desc">Unsecured personal financing</div></div>
                    <div class="loan-type-card" data-type="home" onclick="selectLoanType(this)"><div class="loan-type-icon">üè°</div><div class="loan-type-title">Home Loan</div><div class="loan-type-desc">Mortgage and home financing</div></div>
                    <div class="loan-type-card" data-type="auto" onclick="selectLoanType(this)"><div class="loan-type-icon">üöó</div><div class="loan-type-title">Auto Loan</div><div class="loan-type-desc">Vehicle financing options</div></div>
                    <div class="loan-type-card" data-type="business" onclick="selectLoanType(this)"><div class="loan-type-icon">üíº</div><div class="loan-type-title">Business Loan</div><div class="loan-type-desc">Commercial financing solutions</div></div>
                </div>
            </div>
            <div class="form-section">
                <h2 class="section-title">Loan Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Loan Amount <span class="required">*</span></label>
                        <input type="number" id="loanAmount" class="form-input" placeholder="Enter loan amount" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loan Purpose <span class="required">*</span></label>
                        <select id="loanPurpose" class="form-select" required>
                            <option value="">Select purpose</option>
                            <option value="debt-consolidation">Debt Consolidation</option>
                            <option value="home-improvement">Home Improvement</option>
                            <option value="medical">Medical Expenses</option>
                            <option value="education">Education</option>
                            <option value="vacation">Vacation</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loan Term (months) <span class="required">*</span></label>
                        <select id="loanTerm" class="form-select" required>
                            <option value="">Select term</option>
                            <option value="12">12 months</option>
                            <option value="24">24 months</option>
                            <option value="36">36 months</option>
                            <option value="48">48 months</option>
                            <option value="60">60 months</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Interest Rate (%)</label>
                        <input type="number" id="interestRate" class="form-input" placeholder="Auto-calculated or manual entry" step="0.01">
                    </div>
                </div>
            </div>
            <div class="form-section">
                <h2 class="section-title">Customer Selection</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Select Customer <span class="required">*</span></label>
                        <select id="customerSelect" class="form-select" required onchange="updateCustomerInfo(this)">
                            <option value="">Choose existing customer</option>
                            <option value="customer1">John Smith (ID: 12345)</option>
                            <option value="customer2">Sarah Johnson (ID: 12346)</option>
                            <option value="customer3">Michael Brown (ID: 12347)</option>
                            <option value="new">+ Add New Customer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Customer Status</label>
                        <input type="text" id="customerStatus" class="form-input" placeholder="Will be populated automatically" readonly>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-secondary" onclick="saveDraft()">Save as Draft</button>
                <button type="button" class="btn btn-primary" onclick="submitApplication()">Continue to Customer Info ‚Üí</button>
            </div>
        </form>
    </div>
    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, doc, setDoc } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js';
        function selectLoanType(card){ document.querySelectorAll('.loan-type-card').forEach(c=>c.classList.remove('selected')); card.classList.add('selected'); }
        function updateCustomerInfo(select){ const statusInput=document.getElementById('customerStatus'); if(select.value==='new'){ statusInput.value='New Customer - Will create profile'; statusInput.style.color='#fbbf24'; } else if(select.value!==''){ statusInput.value='Existing Customer - Verified'; statusInput.style.color='#4ade80'; } else { statusInput.value=''; } }
        function goBack(){ window.history.back(); }
        function saveDraft(){ submitToFirestore('draft'); }
        async function submitApplication(){ const requiredFields=document.querySelectorAll('[required]'); let valid=true; requiredFields.forEach(f=>{ if(!f.value.trim()){ f.style.borderColor='#ef4444'; valid=false; } else { f.style.borderColor='rgba(255,255,255,0.2)'; }}); if(!valid){ alert('Please fill in all required fields'); return; } await submitToFirestore('pending'); alert('Application saved! Proceeding to next step.'); }
        async function submitToFirestore(status){
            const selectedType = document.querySelector('.loan-type-card.selected').dataset.type;
            const data = {
                id: Date.now().toString(),
                type: selectedType,
                amount: parseFloat(document.getElementById('loanAmount').value),
                purpose: document.getElementById('loanPurpose').value,
                term: parseInt(document.getElementById('loanTerm').value),
                rate: parseFloat(document.getElementById('interestRate').value) || null,
                customer: document.getElementById('customerSelect').value || null,
                status,
                createdAt: new Date().toISOString()
            };

            const loans = JSON.parse(localStorage.getItem('loans')) || [];
            loans.push(data);
            localStorage.setItem('loans', JSON.stringify(loans));

            try{
                await setDoc(doc(collection(db, 'loanApplications'), data.id), data);
            }catch(err){
                console.error('Firebase save failed', err);
            }
        }
    </script>
</body>
</html>
